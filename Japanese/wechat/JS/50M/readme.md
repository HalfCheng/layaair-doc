# 微信小游戏的50M物理缓存管理

>author：charley

###物理キャッシュの意味

WeChat Gamesは、ローカル・パケットの他に、開発者が50 Mの物理的キャッシュ空間を使用することができます。つまり、最初にロードした後、物理キャッシュにあるリソースは、リモートで動的にロードする必要がなく、直接にローカルのキャッシュリソースを使用すればいいです。このように、ユーザーに大量のダウンロード流量を節約させるだけではなく、原生アプリゲームのようなオープンスピードも持っています。



###LayaAirエンジンデフォルトのキャッシュ管理システム

LayaAirエンジンでは、エンジン層が自動的に開発者のキャッシュ管理を行う仕組みになっています。デフォルトで起動するのはキャッシュ管理機構です。

自動キャッシュの管理モードで、**リソースがローカルキャッシュにないことが検出された場合、リモートのリソースは自動的にキャッシュされる。自動キャッシュモードでは、画像と音声ファイルのみがキャッシュされます。**他のフォーマットのファイルにキャッシュが必要な場合は、手動キャッシュのインターフェースでダウンロードしてキャッシュすることができます。

キャッシュファイルが50 Mを超えると、自動的に最初にキャッシュされた内容を整理し、毎回5 Mの空間を整理します。このように循環的に書き込みます。キャッシュに保存されているのは永遠に最新の50 Mファイルです。



###LayaAirエンジン手動管理キャッシュのインターフェース

####1、自動キャッシュの解除

ゲームの常用リソースが50 M以上の場合、キャッシュを自動的に管理するファイルを使用すると、開発者の予想に達するとは限りません。特に初期にロードされた資源は、常用資源であれば、後にロードされた資源キャッシュが50 Mを超えた後、早期にキャッシュされた資源を整理します。次の利用時にもう一度ロードします。したがって、一般的なリソースが50 M以上の場合、開発者はどのようなリソースがキャッシュされているかを自分で判断することを提案し、ユーザーにとってより良い経験をする。この場合は、キャッシュモードをキャンセルすることができます。

エンジンの自動管理キャッシュが必要でない場合は、MiniAdpter.autCacheFileをfalseに設定することができます。注意したいのは、自動キャッシュが閉じられた後、自動的に整理されないため、50 Mを超えるとキャッシュに書き込めなくなります。必ずキャッシュポリシーを確立して、どのファイルがキャッシュされるかを決めます。どのファイルがマニュアルで整理されますか？



####2、手動でファイルをダウンロードし、ローカルをキャッシュする

自動キャッシュ機能を使用しない、または自動キャッシュモードで、jsonなどの自動キャッシュではキャッシュされていないファイルの内容をキャッシュする場合は、down＿LoadFile方法を使用して、目的ファイルをダウンロードし、ローカルにキャッシュすることができます。


```javascript

/**
* 下载文件 
* @param fileUrl 文件地址(全路径)
* @param fileType 文件类型(image、text、json、xml、arraybuffer、sound、atlas、font)
* @param callBack 文件加载回调,回调内容[errorCode码(0成功,1失败,2加载进度)
* @param encoding 文件编码默认 ascill，非图片文件加载需要设置相应的编码，二进制编码为空字符串
*/             
public static function downLoadFile(fileUrl:String, fileType:String = "",callBack:Handler = null,encoding:String = "ascii"):void
```




####3、キャッシュファイルをクリアする

WeChat Gamesのキャッシュ上限は50 M物理空間ですので、キャッシュを自動管理しても手動管理キャッシュを使っても上限に達したらキャッシュをクリアする必要があります。整理するたびにキャッシュサイズはデフォルトでは5 Mです。キャッシュの整理毎にデフォルトの値を変更したい場合は、変更します。

MiniAdpter.minClearSize属性で良いです。

指定されたキャッシュファイルまたはすべてのキャッシュファイルを削除する場合は、removeまたはremoveAllメソッドを使用することができます。


```javascript

/**
* 删除指定缓存文件
* @param fileUrl文件路径(绝对地址)
* @param callBack 删除回调函数
*/
public static function remove(fileUrl:String,callBack:Handler):void {}
```



```javascript

/**
* 清空缓存空间全部文件内容 
*/  
public static function removeAll():void{}
```




この文書に疑問があれば、公式サイトに質問してください。コミュニティの中のリンクを公式QQ群の中@管理人charleyに送ってもいいです。

コミュニティURL：https://ask.layabox.com/



##この文章は賞賛します

本論文があなたのために役立つと思ったら、スキャンコードの作者への賞賛を歓迎します。激励は私たちがより多くの優れた文書を書くための動力です。

![wechatPay](../../../wechatPay.jpg)