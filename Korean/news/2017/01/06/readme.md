#위신 IOS 클라이언트가 WKWebview 커널, HTML5 의 성능이 4배 높아진다!

2017-01-06

지난번 위신안탁이 X5 Blink 커널 승진 성능과 호환성 문제 해결 후 2017년 1월6일 밤, 위신IOS 도 중대한 이호소식을 발표했다. "위신 IOS 클라이언스가 WKWebview 내핵으로 업그레이드 될 것이니 웹 개발자 빨리 잘 어울린다"고 밝혔다.비기술 개발자에게는 이 말이 무엇일까요?Layabox 작은편은 먼저 답을 던지고 천천히 읽는다.

지난번 위신안탁이 X5 Blink 커널 승진 성능과 호환성 문제 해결 후 2017년 1월6일 밤, 위신IOS 도 중대한 이호소식을 발표했다. "위신 IOS 클라이언스가 WKWebview 내핵으로 업그레이드 될 것이니 웹 개발자 빨리 잘 어울린다"고 밝혔다.비기술 개발자에게는 이 말이 무엇일까요?Layabox 작은편은 먼저 답을 던지고 천천히 읽는다.

**업그레이드 후의 좋은 점**

>>**하나, HTML5 렌더의 성능이 4배 높아졌다.**
>>
>>**둘째, 메모리 점용은 30퍼센트로 줄어들 것이다.**

소편은 기술형이 주는 성능 테스트 링크를 대조한 뒤 현재 위신 네미스 UIWebViewiew Safari Webview 커널의 성능 격차가 4배에 이른다.메모리 점용은 30% 정도 줄일 수 있다.위신 아이오S 클라이언트가 WKWebview 로 업그레이드 된 것이 바로 Safari 현재 WKWebview 커널입니다.**성능 향상과 메모리 점용의 감소는 HTML5 대형 게임의 개발업체로서는 중대한 이호 소식이다. 미래 HTML5 게임은 APP 게임의 효과를 쉽게 실현할 수 있다.**

**업데이트 시간 주기**

위신 아이오S 클라이언트는 2017년 3월 1일 전 WKWebview 내핵으로 급격할 예정이다.

#### **배경**

WKWebView 는 아이OS 8에서 도입된 새로운 구성 요소로 현대의 지지를 제공하는 최신 Webkit 기능을 제공하는 웹 브라우징 컨트롤에서 벗어나 과거 UIWebView 의 늙고, 낡은, 둔함, 특히 메모리 점용량이 큰 문제입니다.Safari 같은 Nitro 자바스크립트 엔진을 사용하여 페이지 js 실행 속도를 크게 높였다.

####전환 방법

iOS 위신 6.5.3 버전이 개발자 수동 지원을 시작으로 WKWebview 와 UIWebview 를 변경하여 개발자가 WKWebview 를 미리 맞추게 할 수 있습니다.

**수동 전환 입구:**

위챗 세션 목록 페이지에서 오른쪽 왼쪽 오른쪽'가호 단추'를 누르고 메뉴 중'친구 추가하기'를 선택하십시오. 친구의 인터페이스 검색 상자에 문자열을 입력하십시오: ': switchweb', 키보드 오른쪽 오른쪽 검색 단추를 누르십시오.성공한 후 현재 사용된 커널은 UIWebview 또는 WKWebview 입니다.

**검사 전환 방법:**

명령을 통해 WKWebview (Webviewiew) 로 전환한 후 현재 웹 페이지를 통해 사용할 수 있는지 확인하십시오.

위챗 내 임의의 입구가 임의 홈페이지에 들어가고, 웹 페이지에 성공한 후 페이지를 누르거나 오른쪽 오른쪽 오른쪽 오른쪽 메뉴 단추를 누르면 주소 표시줄을 표시할 때 '웹 페이지' 를 사용하면 현재 WKWebviewiew, 웹 페이지를 사용하면 'UIWebview' 를 사용합니다.

**현재 사용된 webview 커널을 어떻게 판단합니까:**

페이지에서 위신으로 주입할 수 있는 window.uwxjsuisu wkwebview 변수를 통해 현재 사용된 webview 커널을 판단할 수 있습니다.iOS 위신 6.5.3 및 그 후 버전 window.u wxjsuisu wkwebview 는 truew 를 사용할 때 WKWebview, false 나'undefine'를 위한 UIWebview.

**앞부분에 관심을 맞추는 요점**

적절한 원칙: WKWebviewiew의 새로운 행동인지 위신 내부 논리로 인해 기존 페이지가 문제가 발생할 때, 테스트 페이지와 웨이브웨이 네클을 구분하지 못하면 빠른 위치로 발생한 원인이 될 수 있다.

####안내

WKWebview 로 전환한 후 위버비뉴 행위와 Safari 사이에서 높은 일치를 유지하고 있으며, 유일한 차이는 웨이브비에우에서 위신 JSBridge 와 관련된 스크립트를 추가합니다.그래서 적당한 포인트는 다음과 같은 여러 방면에 관심을 가져야 합니다:

>: 페이지 기능이 정상인지 여부
>>
> 2: 페이지 화면에 정상 3: 페이지 행위가 정상인지 여부 (예를 들면 사용자가 페이지를 훑어볼 때 되돌림 단추를 누르면 페이지의 페이지 논리가 정상적으로 돌아갈 수 있는지)
>>
> 4: 페이지에서 사용하는 문법 호환 여부.
>>
>> 5: JSSAPI 정상적인 작업이 가능한가.
>>
> 6: 쿠키와 LocalStoorage 등 관련 논리가 정상적이었는지 주목한다.
>>
>> 7: Cache-Control 캐시 유효기간을 설정하면 관련 논리의 정상 여부를 검사해야 합니다.

정상적인 상황에서 당신의 페이지는 특별한 적절한 배합을 필요로 하지 않지만, 당신의 페이지가 다음 몇 개의 영향을 받는 논리에 관련되어 있으면 적당한 조언에 따라 적절한 배합 및 확인을 해야 합니다.

JSAPI 관련 어울리기

cache 지원

변화: WKWebview 에서 당분간 cache jsapi 를 지원하지 않을 것이다.

해당 건의: 이 api 개발자는 페이지 관련 논리를 제거할 수 있습니다.

2: 페이지 로칼ID 미리 보기

변화: chooseimage api 로 되돌아오는 localld 를 지원하지 않습니다: "img src = wxLocalResource: / / 5011465932" 방식으로 그림을 미리 보기

알맞은 제안:

1. 아이오스 위신6.5.3 버전 및 다음 버전에서 새로 증가한 jsapi: getLocalImgData 가 LocalID 에 해당하는 그림 base64 인코딩을 받은 뒤 앞쪽 페이지에 나타난다.

2. 페이지에 JSSDK 를 도입하면 JSDK를 1.2.0 최신 버전으로 업그레이드하면 자동으로 적용할 수 있습니다.(현재 JSSDK 선상 버전은 1.0.0, 1.0, 1.0, 업데이트 버전은 1.2.0, [htttps:res.wx.qqq.com/open/js/js/jweixin-1.0.0.js]()

3: JSSDK 를 사용하고 wx.config 의 권한을 사용하여 jsapi 호출의 실패 문제에 관심을 가져야 합니다

변화: WKWebview 의 내부 변경은 위신에 대한 페이지 jsapi 권한관리를 일정한 논리적 조정을 하였고, 이전에 허가가 정상적인 jsapi 인증 권한이 정상적이지 않아 jsapi 호출 실패를 초래했다.

알맞은 제안:

1. iOS 위신 6.5.1, WKWebview 이 버전에서는 이하 문제: 페이지에서 HTML5 History API pushstate, pstate, pstate, replacestate 등 페이지 컨트롤 컨트롤 컨트롤 페이지(전형적인 형식 적용), JSDK의 wx.config 를 jsapi 가 권한 없이 사용할 수 있는 문제가 발생할 수 있다.6.5.1 중 페이지가 가능하다면 Anchor hash 기술을 사용하여 하이토리 기술을 바꾸어 이 문제를 해결할 수 있다.

2. 아이오스 위신 6.5.2 및 그 후 버전은 이상 문제가 없을 것이지만, 마스터나 하샤 기술을 사용하여 페이지 주소를 변경하는 페이지는 전혀 이런 문제가 없었고, 개발자가 이 문제를 주목해야 한다.

쿠키와 LocalStoorage 설정 관련

하나: 웨이보 계정을 탈퇴한 후 모든 쿠키와 로칼스토어를 비우도록 하겠습니다.

2: 페이지 기능은 쿠키에 의존하거나 쿠키에 관련된 논리가 있다

변화: WKWebview 내부 변경은 현재 페이지 쿠키와 관련된 논리에 영향을 미칠 수 있습니다. 예를 들어 대역 액세스 쿠키와 페이지의 자원이나 그림 메모리 서버는 Cookie 에 의존되어 데이터로 돌아갈 수 있습니다.

문제는 페이지 A 를 방문할 때 페이지 A가 다른 페이지 B 의 자원 (페이지 A와 B를 다른 도메인 이름) 을 인용할 때 페이지 B는 제3자 페이지라고 여긴다.페이지 B 에 쿠키를 설치하면 WKWebview 아래 제3자 다운로드 설치 쿠키의 안전 정책을 막기 때문에 문제가 발생한다.

알맞은 제안:

WKWebview 에서 다역의 제3자 설정을 기본적으로 차단합니다.쿠키를 통해 전달되는 모든 정보는 비즈니스 백스테이션을 통해 전달할 수 있는 정보를 포함한 메모리 정보에 상대적으로 저장된 acccessu token 에 비밀번호를 더하고, Url 에 자신의 업무를 포함한 acccessu token을 통해 페이지 정보를 전달할 수 있습니다.

페이지의 자원이나 그림에 저장된 서버가 Cookie 에 의존하는 경우, WKWebview 로 전환한 후 위신에서 길이를 저장하거나 미리 보기 그림을 클릭할 때 설정된 쿠키를 완전하게 가져올 수 없습니다. 그림에 실패하거나 미리 보기 실패할 수 없습니다.이 상황을 제외하고는 개발자는 다른 상황에서 쿠키를 잃어버린 문제를 걱정할 필요가 없다. 모든 요청은 완전한 쿠키를 가지고 있다.

페이지 비디오 창

변화: 아이오스 위신 6.5.3 및 그 후 버전에서 Webview 기본으로 창 재생 지원을 합니다.

개발자 는 특히 소창 재생 을 필요 로 앞 부분 과 iOS10 과 iOS10 이하 저버전 을 적용 해야 한다



WKWebview 페이지 행위는 Safari 와 완전히 일치하여 페이지가 UIWebview 페이지에 의존하는 논리나 이상: (업무 자체 논리에 따라 테스트 페이지를 실현할 수 있어 각각 Safari와 웨이브비뉴에서 검증)

1: Safari 나 위신 WKWebview 페이지 A 로 돌아서 페이지 A로 다시 돌아와 Script 및 Ajax (페이지 reload) 를 다시 실행하지 않습니다.

2: Safari 나 위신 WKWebview 에서 키보드를 입력한 후 JQuery resize 이벤트를 터트릴 수 있으며 UIWebView 아래에서 할 수 없습니다.

3:Safari 또는 웨이웨이 WKWebview, window unload 사건은 새로 고쳐야 촉발할 수 있으며 페이지를 탈퇴하거나 다른 페이지로 넘어가도 건드릴 수 없습니다.

4: Safari 또는 위신 WKWebview 중 극소수 상황에서 어떤 특수한 페이지 클릭 사건이 효력을 잃게 된다.

만약 관련 혹은 이상의 문제가 있다면, 사파리 행위를 겸용할 수 있는 것으로 나타났다.