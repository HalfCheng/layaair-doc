#마이크로 마이크로 게임 포털 실전

> author: charley

일부 대형 게임에 대해서는 웨이스트 게임의 4M 초청백이 원활하지 않다. 광JS 가 4M을 넘어서기 때문에 2.1의 작은 게임 베이스를 내놓기 전에는 끊임없이 베기 기능을 할 수밖에 없어 JS가 4M보다 작다.(초보자가 있다면 이게 왜?그럼 먼저 기초를 알아보고 본문을 보자.소규모 게임 베이스 라이브러리는 2.1 버전부터 분백을 통한 형식을 지원해 올린 가방을 8M으로 확대하면 어떻게 분백을 진행할 것인가?

**이 편은 분포 방식을 소개할 뿐만 아니라, 소신 소규모 게임은 분배 과정에서 흔한 문제를 만나 실례 DEMO 를 통해 관련 소개를 통해 개발자가 작은 게임의 분포 방식과 주의사항을 이해하도록 돕는다.**



###하나, 정말 나눠야 하나요?

마이크로게임 패키지 또는 AS 프로젝트에 대한 포괄 및 사용이 익숙하지 않은 개발자, 분백은 오히려 당혹과 장애에 직면할 수 있다.그래서 우리가 배포를 나누기 전에 반드시 자신의 프로젝트를 분석해야 하는 것이 정말 포괄 수요가 있는 것인가?사실 현재 대다수의 제품에 대해 말하자면, 가방을 나누지 않아도 작은 오락 제품에 올라갈 수 있다.

####1, UI 가재 또는 분리 모드를 사용한 적이 있습니까?

Layaiair 엔진의 개발자, UI 대부분 레이어이더를 통해 제작됐다.

F9 의 UI 모드 옵션, 프로젝트 관리자, 오른쪽 UI 페이지에 기본 속성 설정을 설정할 때 내보내는 유형 옵션을 볼 수 있으며, 암재 모드, 복사 모드, 분리 모드, 세 가지 옵션을 볼 수 있습니다.

![图1](img/1.png) 


**기본 내장 모드**이 모드에서 UI 페이지를 내보낼 때 정보 설정 등 콘텐츠를 프로젝트의 코드 파일로 내보낼 것입니다.결국 작은 게임으로 발표될 때는 js 파일입니다.작은 게임의 로컬 포장 부피를 점용했다.그래서**작은 게임의 패키지 크기를 줄이면 UI 모드를 불러오기 모드 또는 분리 모드로 바꿀 수 있다.**이 두 모드 모두 페이지 설정 정보 등을 json 파일로 내보내며 json 파일을 URL 원격 동태를 통해 사용할 수 있으며 로컬 백공간을 점용할 수 없습니다.

>>**Tips:**
>>
>> 1, 다운로드 모드 및 분리모드의 구별은 UI 페이지를 모든 json 파일로 내보내기 위해 json 파일을 분리 모드로 각각 UI 페이지에서 독립된 json 입니다.
>>
> 2, 주의해야 할 것은 모드 및 분리 모드, 내보내는 것은 json 이기 때문에 코드를 사용할 수 있다.내장 모드 필요 없습니다.

어쨌든 패턴과 분리 패턴을 가재 패키지 JS 의 크기를 줄일 수 있다.이런 식으로 해결할 수 있다면, 분포로 해결할 필요는 없을 것이다.구체적인 상황은 항목을 보고 결정한다.

####2, 압축과 혼동

압축 혼동 후 js 코드를 통해 가방이 많이 줄었다.JS 가 4M을 넘지 않았다면 나눠 주지 않아도 된다.자원 등 내용은 URL 동태를 가재할 수 있으며, 첫 가재 후 물리 캐시 내에 50m의 상용 캐시 콘텐츠를 초과하지 않으며, 다음에는 가재할 필요가 없다.



###둘째, 작은 게임 공식 패키지 문서

실전패키지 전에 공식 문서는 보지 못했으니 반드시 자세히 살펴보아야 한다.이것은 매우 유용합니다. 아무리 이해가 되더라도 문서의 요점을 먼저 알아야 더 잘 이해할 수 있습니다.다음과 같이 링크는 먼저 보고 뒤의 절차를 진행하십시오.

[https://developers.weixin.qq.com/minigame/dev/tutorial/base/subpackages.html](https://developers.weixin.qq.com/minigame/dev/tutorial/base/subpackages.html)



###셋, 마이크로 게임 공식 패키지

많은 개발자들이 공식 분포 문서를 이미 보았지만, 여기에는 포인트를 주워 넘기는 것이 좋다.

####1. game.json 중 분포와 분포경로 구성된 필드


```json

{
  ...
  "subpackages": [
    {
      "name": "stage1",
      "root": "stage1/" // 可以指定一个目录，目录根目录下的 game.js 会作为入口文件，目录下所有资源将会统一打包
    }, {
      "name": "stage2",
      "root": "stage2.js" // 也可以指定一个 JS 文件
    }
  ]
  ...
}
```


subpackages 에는 여러 개의 name, root, 한 팀당 1점씩 포장, 1점으로 4M을 초과할 수 없고, 모든 게임의 초기 패키지는 8M을 넘지 않으면 된다.

모두 먼저 포장 배치의 구조와 주석 설명을 살펴보고, 초보적으로 이해해 보세요.아직도 이해가 안 된다면 뒤의 실전 배치를 결합하여 이해할 수 있다.

####2, 작은 게임 공식 분포 가재 사례 코드

소규모 게임 공식 제공[wx.loadSubpackage()](https://developers.weixin.qq.com/minigame/dev/document/subpackages/wx.loadSubpackage.html)API 계열백의 다운로드, wx.loadSubpackage 호출 후 감발백의 다운로드와 다운로드를 마운트한 후, wx.loadSubpaccess를 통해 재고합니다.예시 코드 다음과 같습니다:


```javascript

const loadTask = wx.loadSubpackage({
  name: 'stage1', // name 可以填 name 或者 root
  success: function(res) {
    // 分包加载成功后通过 success 回调
  },
  fail: function(res) {
    // 分包加载失败通过 fail 回调
  }
})
```


성공과 동시에 wx.loadsubpackage가 다시 돌아옵니다[LoadSubpackageTask](https://developers.weixin.qq.com/minigame/dev/document/subpackages/LoadSubpackageTask.html)LoadSubpackageTageTak을 통해 현재 다운로드 진도를 얻을 수 있습니다.예시 코드 다음과 같습니다:


```javascript

loadTask.onProgressUpdate(res => {
  console.log('下载进度', res.progress)
  console.log('已经下载的数据长度', res.totalBytesWritten)
  console.log('预期需要下载的数据总长度', res.totalBytesExpectedToWrite)
})
```


이 문서는 주로 분배 방법과 개발자가 자주 만나는 window 역으로 인한 분포 문제이다.다운로드 진도는 쉽게 이해하기 쉽고 개발자 피드백 문제에 부딪치지 않았기 때문에 실전 코드에서 언급하지 않았을 때 이 문제에 부딪히면 커뮤니티에서 제출할 수 있다.



 	



###사례 항목 다운로드

간단한 예제 항목을 다운로드 해제 후 defaultDemo 디렉터리에서 패키지를 나누기 전 예제 항목, subPackageDemo 디렉터리에서 패키지를 나누는 사례 항목입니다.개발자는 본 문서를 읽을 수 있는 동시에 분백 전과 분백 후 항목의 차이를 대비해 작은 게임 패키지를 이해하는 데 도움이 된다.

다운로드 주소:[https://github.com/layabox/layaair-doc/raw/master/project/AS3/AS_subPackage_Demo.zip](https://github.com/layabox/layaair-doc/raw/master/project/AS3/AS_subPackage_Demo.zip)



###5, 실전 포인트

####1, 위신 개발자 도구 및 발표 프로젝트 주의

실전분포의 첫걸음은 반드시 위챗개발자 도구 중 작은 게임 프로그램을 만들기 마련해야 한다.일단 가방을 나눠서 사용하는 것은 작은 게임의 가재 모드로 브라우저에서 달리지 못했기 때문에 모든 디버그 프로세스가 위신개발자 도구에서 완성되었습니다.그래서 여러분들을 위한 예시 항목을 다운로드하기 위해 데플디모 디모의 디렉토리 디렉터리를 열고 작은 게임 버전을 발표합니다.기초 디버그 프로세스를 뚫다.

> Tips:여기에 주의해야 할 것은 다운로드 프로젝트입니다. 기본적으로 발표된 기록은 이미 발표된 디렉터리입니다. 그래서 발표할 때 실제 디렉터리로 바꿨습니다.

####2, 베이스 버전

트위터 개발자 도구의 디버그 베이스 베이스 버전이 무엇인지 반드시 검사해야 한다. 그렇지 않으면 본문 조작을 따라 사용하면 패키지를 지원하지 않는 버전으로 디버깅을 하면 문제가 생긴다.

개발자 도구는 1.02.1806120 및 이상 버전을 사용합니다.

기초 라이브러리는 2.1.0 및 이상 버전을 사용합니다.

이 문서는 2.2.0으로 사용된다.그림 1의 보여 주기:

![图2](img/2.png) 


(2)

####3. 패키지 디렉토리 관련 조작

#####개정 game.json

패키지를 나누기 전에 포괄 디렉터리를 잘 만들어야 하고, game.json 에서 구현한다.

여기에서 우리는 간단히 포괄 디렉터리를 하나 설정합니다.defaultDemo 의 예제 항목 내의 game.json 을 다음으로 바꿀 수 있습니다:


```json

{
  "deviceOrientation": "landscape",
  "showStatusBar": false,
  "networkTimeout": {
    "request": 10000,
    "connectSocket": 10000,
    "uploadFile": 10000,
    "downloadFile": 10000
  },
  "subpackages": [
    {
      "name": "b",
      "root": "js/subpackage/"
    }
  ]
}
```


계획과 완소 게임의 분백 디렉터리를 설치한 후.우리는 AS 항목의 분백 파일과 디렉터리를 만들기 위해 갔다.

#####AS 분백 파일 만들기 module.def

… 에**항목의 루트 디렉터리**일반 텍스트 파일 만들기`module.def`파일 중 입력 내용은 다음과 같습니다:


```json

module:"subpackage/b"
path:"src/subpackage"
```


**module 의 값은 새 js 이름과 경로를 나누어 만든다.**상위 예절 중 subpackage 는 분백 후 디렉토리 이름, b 를 js 파일이름으로 표시하지 않으려면 디렉터리만 작성하면 디렉터리가 포함되지 않는 b.js 로 생성됩니다.

여기에서 언급해야 할 것은 디렉터리가 있어도 목록이 없으면 생성된다`bin/h5/js`목록 아래.상례의 가치와 같이 실제 생성된 경로가 되다`bin/h5/js/subpackage/b.js`.그래서 작은 게임에 대응하는 game.json 의 계획에 대한 경로`js/subpackage/`.

**path 내 값 대표는 module 대응하는 AS 원본 파일 디렉터리**.설명이 필요한 것은 path`src/subpackage`만약 여러 as 파일이 있다면, 모든 파일 사이의 인용관계가 있다면, 같은 js 내 (module 지정한 값으로 통역할 수 있습니다.

>> module 와 path 의 값은 모두 인용번호에 넣어서 끝나면 부호가 필요하지 않지만 꼭 바꿔야 한다.

#####특히 중요한 인용 관계

포장 중 종류는 주 가방에서 반드시 인용해야 하며, 만약 인용되지 않으면 된다.파일을 분배하지 않습니다.`module.def`내부`path`경로 내의 코드 컴파일로 지정`module`지정한 디렉터리 및 파일 중.분포와 포트 사이도 마찬가지로 현재 코드 사용을 막론합니다.반드시 인용해야 한다.

예를 들어 예시 항목에서 subpackage 가방에 있는 b 류를 도입합니다.


```typescript

import subpackage.b;
```





 



####4. 포털 코드 사용

1단계 패키지 파일과 디렉토리의 생성 및 기획을 완료하면 분포 인코딩을 시작할 수 있습니다.

우선 원칙적으로, 배당을 하려면, 그렇다면.**메인 패키지 및 패키지 논리적 연관성은 최대한 적을수록 좋다**.

또 한 마디씩 가방을 나누는 TS 와 JS 는 윈도메인 프로젝트를 개조하고, AS 는 윈도우역에 대한 수정을 필요로 하지 않기 때문에 번역기가 개발자 처리를 도왔다.Layair 엔진의 분포 규칙에 따라 처리해야 합니다.

그래서 분포 중 종류와 방법을 어떻게 사용할지 중점적으로 설명한다.분백의 예례는 내가 제공한 예를 직접 다운로드할 수 있다.


```javascript

//图集加载后回调
private function onLoaded():void
{

    showUI(aUI);
	//微信小游戏官方提供的分包加载方法
    const loadTask = __JS__('wx').loadSubpackage({
        name: 'b', // name 可以填 name 或者 root
        success: function(res) {
            // 分包加载成功后通过 success 回调
            console.log("success");

            //实例化分包的类
            b = __JS__('new subpackage.b()');

            //把实例化的UI传给分包的类
            b.newUI = newUI;

            //初始化分包，监听按钮事件
            b.init();
        },
        fail: function(res) {
            // 分包加载失败通过 fail 回调
            console.log("fail");
        }
    });

}
```


onLoaded 이 방법을 살펴보다 showui가 UI 를 표시한 후 위신 소규모 게임 공식 패키지 가재 방법을 직접 사용했다.패키지가 성공한 후 succcess의 반전 방법 안에 우리는 통과하기 시작했다`__JS__（'new subpackage.b()'）；`실례화된 패키지 내의 방법.여기에 왜 JS 의 방법으로 실례를 가졌을까. 직접적으로 포장된 내용으로 번역된 후 다른 js 로 나눠졌기 때문에 같은 파일에 대응할 수 없는 종류를 찾을 수 없다면 오류가 발생할 수 있다.그래서 분백의 종류와 방법을 사용하려면 반드시 사용해야 한다`__JS__（'XXX'）；`xxx 는 js 코드.

####5、총괄

AS 프로젝트의 분백은 사실 공식 예시의 기초에 AS 프로젝트를 사용하면 된다.예전에는 가방을 나눠 주는 개발자에게 AS 의 작은 오락패키지는 순조롭게 될 것이다.그래서 이번 편은 사실 작은 게임과 결합해서 다시 AS 의 프로젝트를 어떻게 나눠야 할지 다시 한 번 이야기했다.

**AST 가방 요점 돌이켜**：

1, 프로젝트 루트 디렉토리에서 module.def 파일 만들기

2, 정확한 분백을 작성한 후 경로와 js 파일 이름 (module) 과 정확한 대응 원본 파일 경로 (path);

3, 부호 코드 파일 만들기

4. 주 가방 안에 분포를 인용한 종류;



###개발자 실전 건의

개발자는 내가 준 예시 항목을 먼저 나누어 시도할 수 있다. 만약 문제가 생기면, 이 문서와 비교해 준 두 개의 예제 항목의 구별을 볼 수 있다.먼저 웨이터 게임에서 뛰어.진정한 이해분포 후 자유로운 실전 소게임포트.문제가 생기면 커뮤니티에 문제를 보내고, 질문에 예례 DEMO 항목을 올릴 수 있습니다. @ 관리자 charley, 링크를 제공합니다.

후속은 개발자가 분백에 새로운 문제가 있음을 발견한다면, 본편을 다시 갱신할 것이다.、



##본문 칭찬

만약 본문은 당신에게 도움이 된다고 생각하시면, 스코드가 작가님을 환영합니다. 당신의 격려는 우리가 더 우수한 문서의 동력입니다.

![wechatPay](../../../wechatPay.jpg)