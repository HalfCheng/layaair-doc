# 小游戏发布工具与小游戏目录介绍

> Author: charley
>
> 本文档基于LayaAirIDE 1.7.19.1beta版本撰写

### 1、IDE发布功能介绍

点击发布按钮，并选择微信小游戏时，发布界面是这样子的，如图1所示。

![图1](img/1.png) 

（图1）

##### 关于发布目录

源根目录与发布目录比较容易理解，通常用默认的就可以。如果是复制项目目录导致目录变化的，要检查一下目录是不是正确。另外，**目录路径内不允许有空格、中文、以及中文符号等，否则会导致发布失败。**

##### 排除文件的作用

这里经常有开发者不太理解。这里选择好排除的目录后，排除的目录内文件并非是不发布，而是不压缩。在这里排除后，后面所有勾选了压缩的选项，都会跳过这些排除目录内的文件。

##### 压缩与版本管理

那些压缩的选项，勾选后即启用压缩，具体的使用，因为比较直观，可以自行体验尝试，不多介绍。需要说明的是，一旦启用后会比较耗时。整个发布时间都会延长。并且，在不勾选启用版本管理的选项情况下。每次发布，都会对所有没有排除的文件进行压缩。因此，如果只是部分进行了更新**，建议启用版本管理，这样，只会对更新的版本进行压缩处理。可以减少一定的发布耗时。**

如果有开发者有更好用的第三方压缩工具，可以不勾选IDE自带的压缩工具，通过最下面的`后续执行脚本`功能，执行自定义的命令行工具或者是脚本，用自己喜欢的工具来压缩。（*也可以把特别好用的工具推荐给charley*）

##### 关于复制文件

比如，在项目中已经规划好了本地包目录，那么通过复制文件的两个选项功能，将本地包的目录直接复制到小游戏的项目目录内。当然，根目录中的文件还是要手工处理一下，针对这块，工具组同学还在优化中，后续版本可以解决。

### 2、发布后的小游戏目录介绍

![img](img/2.png)  

（图2）

#### `code.js`项目文件 与 `libs` 引擎库目录

libs目录一般情况下，可以不用复制到小游戏目录内，因为，为了window域的问题，发小游戏的时候会把整个游戏项目以及引用到的库已经合到code.js里了。但是假如TS与JS项目没在index.html里引用，而是在项目中引用了，或者是AS项目里用require的方式引用了。那都不会合到code.js。这时候，还是要手动针对自己使用的库，尤其是第三方库，进行手工复制。

#### `res`资源目录

res是默认的资源目录，小游戏由于初始包的限制，建议将初始包的内容在规划好，最好能放到统一的目录下，便于初始包的剥离。

该文件会将js合并成一个JS

#### `game.js`微信小游戏的入口文件

游戏项目入口JS文件与适配库JS等都是在这里进行引入。IDE创建项目的时候已生成好，一般情况下，这里不需要动。

#### `game.json` 小游戏的配置文件

开发者工具和客户端需要读取这个配置，完成相关界面渲染和属性设置。比如屏幕的横竖屏方向，状态栏的显示、小游戏分包等，都是在这里配置。具体如何配置，以及参数的使用，可以[查看微信小游戏的开发文档](https://mp.weixin.qq.com/debug/wxagame/dev/index.html?t=2018115)。

#### `project.config.json`小游戏的项目配置文件

文件里包括了小游戏项目的一些信息，如果想修改appid等信息，可以直接在这里面编辑。

> 项目参数libVersion的值一定要是game，这里一般不会出错。但是，万一出现了LayaAirIDE里发布正常，也引用了适配库，发布为小游戏后，在开发者工具里还是有报错的话，可以检查libVersion里的值是不是game。不是的话要改为game。

#### `weapp-adapter.js` 微信小游戏适配库文件

LayaAirIDE的发布工具在发布时会自动引用。



